<%
  metadata = {
    :Title => @document.title,
    :Author => "John Doe",
    :Subject => "My Subject",
    :Keywords => @document.keywords,
    :Creator => "Dangerous Precedent & CÃ´deazur",
    :Producer => "startbudding.com",
    :CreationDate => @document.created_on,
    :Grok => "Test Property"
  }
  pdf_doc = Prawn::Document.new(:page_size => "A4", :info => metadata)
  pdf_doc.font "Helvetica"
  pdf_doc.font_size 12

  pdf_doc.indent 20 do
    pdf_doc.text @document.title, :size => 24, :align => :center

    pdf_doc.text "Summary:", :style => :bold, :indent_paragraphs => -10
    pdf_doc.text @document.short_summary

    pdf_doc.text "Teaser:", :style => :bold, :indent_paragraphs => -10
    pdf_doc.text (@document.teaser || "")

    pdf_doc.text "Complete copy:", :style => :bold, :indent_paragraphs => -10

    if @text_blocks
      links = []
      for paragraph in @text_blocks
        paragraph.gsub!(/<(\w+) href=\"([^\"]+)\">([^(?:<\/\1)]+)<\/\1>/) do |m|
          links << $2
          "#{$3} [#{links.length}]"
        end
        paragraph.gsub!(/<\/?[^>]+>/, "")
        pdf_doc.text paragraph
      end

      pdf_doc.text "\n"
      links.each_with_index do |link, index|
        pdf_doc.text "[#{index+1}] #{link}"
      end
    end

    pdf_doc.text "Locations:", :style => :bold, :indent_paragraphs => -10
    pdf_doc.text (@document.locations || "")

    pdf_doc.text "People:", :style => :bold, :indent_paragraphs => -10
    pdf_doc.text (@document.people || "")

    pdf_doc.text "Companies:", :style => :bold, :indent_paragraphs => -10
    pdf_doc.text (@document.companies || "")

    pdf_doc.text "Keyword:", :style => :bold, :indent_paragraphs => -10
    pdf_doc.text (@document.keywords || "")

    pdf_doc.text "Language:", :style => :bold, :indent_paragraphs => -10
    pdf_doc.text @document.language.name
  end

  pdf_doc.font_size 8 do
    pdf_doc.text "\n\n\nCreated on #{@document.created_on.strftime("%a, %m/%d/%Y %H:%M:%S")}"
    pdf_doc.text 'Generated by startbudding.com'
  end

  return pdf_doc.render
%>